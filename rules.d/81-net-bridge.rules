# do not edit this file, it will be overwritten on update

ACTION=="remove", GOTO="net_bridge_end"

# Some devices require the port to be up before joining the bridge.
# In such cases, set ID_NET_BRING_UP_BEFORE_JOINING_BRIDGE to "1".

# Texas Instruments Ethernet device with switchdev mode:
# https://docs.kernel.org/networking/device_drivers/ethernet/ti/am65_nuss_cpsw_switchdev.html#enabling-switch
SUBSYSTEM=="platform", DRIVER=="am65-cpsw-nuss", ENV{ID_NET_DEVLINK_BUS_NAME}="$kernel", GOTO="am65-cpsw-nuss-end"
SUBSYSTEM!="net", GOTO="am65-cpsw-nuss-end"
ENV{ID_NET_DRIVER}!="am65-cpsw-nuss", GOTO="am65-cpsw-nuss-end"
IMPORT{parent}="ID_NET_DEVLINK_BUS_NAME"
ENV{ID_NET_DEVLINK_BUS_NAME}=="?*", \
  PROGRAM="devlink dev param show platform/$env{ID_NET_DEVLINK_BUS_NAME} name switch_mode", \
  RESULT=="*cmode runtime value true*", \
  ENV{ID_NET_BRING_UP_BEFORE_JOINING_BRIDGE}="1"
LABEL="am65-cpsw-nuss-end"

LABEL="net_bridge_end"
