# User Guide: Writing systemd Documentation with the new Sphinx-based System <!-- omit from toc -->

This document is aimed at documentation writers and explains how to write and maintain docs in the (new in 2026) systemd documentation.

If you’re in a hurry and just want to:
- …edit an existing file, look at the [Documentation Syntax](#documentation-syntax).
- …create a new documentation file from scratch, start with the [Documentation File Structure](#documentation-file-structure) first.

## Table of Contents <!-- omit from toc -->
- [Basics](#basics)
- [Differences to the Previous, DocBook-based System](#differences-to-the-previous-docbook-based-system)
- [reStructuredText](#restructuredtext)
  - [Limits of reStructuredText](#limits-of-restructuredtext)
- [Documentation File Structure](#documentation-file-structure)
  - [Actual documentation pages](#actual-documentation-pages)
    - [License](#license)
    - [Metadata](#metadata)
    - [Reference Target](#reference-target)
    - [The Complete Head of a Documentation File](#the-complete-head-of-a-documentation-file)
  - [Include Container Files](#include-container-files)
- [Documentation Syntax](#documentation-syntax)
  - [Title order/Headline order](#title-orderheadline-order)
  - [Defining and referencing systemd directives](#defining-and-referencing-systemd-directives)
  - [Declaring and using includes](#declaring-and-using-includes)
  - [Using External man Links](#using-external-man-links)


## Basics

The systemd docs are built using [Sphinx](https://www.sphinx-doc.org/), a themeable, rich-text, multi-output documentation system used by a number of large projects, eg. Python and the Linux Kernel. It takes `.rst` ([reStructuredText](https://www.sphinx-doc.org/en/master/usage/restructuredtext/basics.html#rst-primer)) files as input and, in our setup, generates both man and HTML pages.

We use several custom Sphinx extensions for systemd, most importantly the "systemd Domain", to give us some additional capabilities Sphinx does not have out of the box, such as:
- The ability to declare and reference grouped systemd directives, such as an "option" in the group "config-directives"
- The ability to have alias pages, eg. `initrd-release` and `extension-release` pointing to `os-release`
- A custom preprocessor so we can have a more terse include syntax, and include parts of other files in more places than originally intended by Sphinx
- Autogenerated index and directive index
- Shorthands for external links

Where necessary, the use of these is explained below.

For the HTML output, we use the [Furo Theme](https://pradyunsg.me/furo/quickstart/) with some minimal modifications (added css and js).

## Differences to the Previous, DocBook-based System

The previous documentation used DocBook with XML input files. These were extremely flexible in terms of structure and referencing, but also very verbose. Sphinx uses a format that is much closer to a human-readable text document with much fewer, less flexible options for structuring and styling, with the benefit of better read- and writability.

## reStructuredText

The input format for the docs is reStructuredText, which is somewhat like Markdown, but broader in scope. It looks a bit like this:

```rst
==============
Document Title
==============

Section title
#############

This is a regular paragraph, and it contains some *inline* styling, such as the previously emphasized word, **this** bold word, and `aBitOf(inlineCode)`. In this way, it is similar to Markdown. However, you can also use so-called *roles* to achieve the same thing: :emphasis:`this is in italics`, :strong:`this is bold` and :code:`this is inline code`.

* This is a bulleted list.
* It has two items

1. This is a numbered list.
2. It has two items too.

.. Psst, you don’t have to do all the numbering by hand though (this is a comment, btw.):

#. This is an *automatically* numbered list.
#. It has two items too.

You can of course link to `systemd <https://systemd.io>`__ or anywhere else if you like.

There are also block-level elements, called *directives*, for example for `code blocks <https://www.sphinx-doc.org/en/master/usage/restructuredtext/directives.html#directive-code-block>`__:

.. code-block:: python

   def some_function():
       interesting = False
       print('Hello')

Or various built-in `admonitions <https://www.sphinx-doc.org/en/master/usage/restructuredtext/directives.html#admonitions-messages-and-warnings>`__:

.. DANGER::
   Beware killer rabbits!

RST can do many more things, and Sphinx adds even more capabilities on top.
```

For a syntax overview, start with [The reStructuredText Primer](https://www.sphinx-doc.org/en/master/usage/restructuredtext/basics.html) in the Sphinx docs, and then read straight on to the Roles and Directives pages. This should suffice to write documentation. If you want to know more about topics like indentation, escaping, and additional details for various syntax elements, dive into the [Docutils RST Spec](https://docutils.sourceforge.io/docs/ref/rst/restructuredtext.html) (Docutils powers Sphinx), and check out their [Directives Docs](https://docutils.sourceforge.io/docs/ref/rst/directives.html). Do note that these Docutils links do not include syntax added by Sphinx.

If you want a fast preview of standard `rst`, use an online editor like https://rsted.info.ucl.ac.be/

### Limits of reStructuredText

If you’re coming from Markdown, reStructuredText has some idiosyncrasies to be aware of:

- No nesting of inline styles. You can’t have an emphasised word in a bold sentence, for example.
- Inline styles often need trailing spaces or escaped trailing characters, with a few [exceptions](https://docutils.sourceforge.io/docs/ref/rst/restructuredtext.html#inline-markup-recognition-rules)
  ```
  ✅ Inline styles in parentheses: (``list``)
  ✅ Inline styles followed by a comma: ``list``,

  ❌ Simply tacking a number or letter on to an inline style
     (of either type) does not work:

  ❌ Python ``list``s use square bracket syntax.
  ❌ Python :code:`list`s use square bracket syntax.

  You’ll have to escape that trailing character to make this work:

  ✅ Python ``list``\s use square bracket syntax.
  ✅ Python :code:`list`\s use square bracket syntax.
  ```
- _Shorthand_ inline styles cannot follow each other directly (without a space in between), use the inline rules syntax for this:
  ```
  ❌ This does not work:
  Python ``list``**s** use square bracket syntax.

  ✅ This does:
  Python :code:`list`:strong:`s` use square bracket syntax.
  ```

## Documentation File Structure

We have two main types of `.rst` files in our documentation:
1. Actual documentation pages
2. Files that only hold text that is included by other files (include container files)

We will cover them in order.

### Actual documentation pages

#### License

The first line of any file must be the license, as an `rst` comment:

```rst
.. SPDX-License-Identifier: LGPL-2.1-or-later
```

#### Metadata

Our documentation files then have 3 or 4 lines of metadata, with `:aliases:` being optional:

```rst
:title: journald.conf
:manvolnum: 5
:summary: Journal service configuration files
:aliases: journald.conf.d, journald@.conf
```

The first three are self-explanatory.

`:aliases:` is a comma-separated list of additional references that should also point to this doc page. These can then be used as regular Sphinx references, despite no actual source file for them existing: ``:ref:`journald.conf.d` `` will link to the `journald.conf` page, and a direct link to the `journald.conf.d` url in the HTML docs will redirect to the `journald.conf` page as well.

#### Reference Target

Finally, the head of each `rst` doc file includes a complete reference target:

```rst

.. _journald.conf(5):

```

The syntax is: `.. _{title}({manvolnum}):`. Note the underscore at the beginning and the colon at the end. This also needs blank lines around it.

You can now link to this file with ``:ref:`journald.conf(5)` ``.

#### The Complete Head of a Documentation File

```rst
.. SPDX-License-Identifier: LGPL-2.1-or-later

:title: journald.conf
:manvolnum: 5
:summary: Journal service configuration files
:aliases: journald.conf.d, journald@.conf

.. _journald.conf(5):

```

### Include Container Files

These are never displayed or linked to directly. Instead, these are just collections of snippets that are included by other files, eg. `common-variables.rst`. As such, they do not need any of the metadata or reference target declarations regular doc files need, but they should have the license comment in their first line:

```rst
.. SPDX-License-Identifier: LGPL-2.1-or-later
```

## Documentation Syntax

Most of what you’ll be writing is standard Sphinx `rst` as mentioned above. In addition, you need to know:

- [Title order/Headline order](#title-orderheadline-order), since this isn’t fixed in the `rst` spec we need to define one
- [Defining and referencing systemd directives](#defining-and-referencing-systemd-directives)
- [Declaring and using includes](#declaring-and-using-includes)
- [Using External man Links](#using-external-man-links)


### Title order/Headline order

reStructuredText is oddly indifferent when it comes to how headlines are declared, but it is very strict in that however this is done, it is done _consistently_. In our case, we use:


```rst
=============
Document Name
=============

Level 1
#######

Level 2
=======

Level 3
-------

Level 4
~~~~~~~

Level 5
^^^^^^^

Level 6
.......
```

> [!NOTE]
> As you can see, the length of the headline markers must match that of the headline.

### Defining and referencing systemd directives

The custom systemd domain allows us to have a neat, concise `rst` syntax for defining and referencing systemd properties. Anything declared this way will also be automatically picked up in the directives list, which is itself a custom systemd Sphinx directive used in `directives.rst`.

Based on the directives config that we’ve defined in `directives_data` in `conf.py`, we define four types of systemd directives:
1. `var`
2. `env`
3. `option`
4. `constant`

These can be used as block-level declarations to define a systemd property, e.g.:

```rst
.. systemd:option:: ExternalSizeMax=, JournalSizeMax=
   :group: config-directives

    Optional text content follows here.
```

As you can see, there is an optional `:group:` attribute that maps to the directive groups in `directives_data` in `conf.py`, and results in the directives being grouped into the proper sections in the directives overview.

Several examples follow:

```rst
.. systemd:option:: list

   Show all peers on the bus, by their service names. By default, shows both unique and well-known names, but this may be changed with the :code:`--unique` and :code:`--acquired` switches. This is the default operation if no command is specified.
```

```rst
.. systemd:var:: $SYSTEMD_LESSCHARSET
   :group: environment-variables

   Override the charset passed to :code:`less` (by default "utf-8", if the invoking terminal is determined to be UTF-8 compatible).
```

```rst
.. systemd:constant:: K
  :group: environment-variables

  This option instructs the pager to exit immediately when :kbd:`Ctrl` + :kbd:`C` is pressed.
```

You can also declare multiple directives at once by comma-separating them, and each will be linkable individually, and appear in the directives list individually:

```rst
.. systemd:option:: SystemMaxUse=, SystemKeepFree=, SystemMaxFileSize=, SystemMaxFiles=, RuntimeMaxUse=, RuntimeKeepFree=, RuntimeMaxFileSize=, RuntimeMaxFiles=
   :group: config-directives
```

To reference (link to) any directive, use the role syntax:

```rst
:systemd:option:`SystemMaxUse=` and :systemd:option:`RuntimeMaxUse=` control how much disk space the journal may use up at most.
```

```rst
:systemd:constant:`SYSTEMD_LOG_LEVEL=debug,console:info` specifies to log at debug level.
```

Really, just throw the whole entry in there:

```rst
:systemd:option:`set-property SERVICE OBJECT INTERFACE PROPERTY SIGNATURE ARGUMENT...`
```

If the same name is defined in multiple documents, you can qualify the reference with the document’s basename (without `.rst` or the manvolnum). For example: `OOMPolicy=` exists in both `systemd.scope(5)` and `systemd.service(5)`, to specify which one you want to reference/link to, prefix the doc name like this:

```rst
:systemd:option:`systemd.scope:OOMPolicy=`
:systemd:option:`systemd.service:OOMPolicy=`
```

You may also use the full docname including the `docs/` prefix:

```rst
:systemd:option:`docs/systemd.unit:After=`
```

The qualifier is matched against:
- full docname (e.g. `docs/systemd.unit`)
- basename (e.g. `systemd.unit`)
- slug form used in anchors (e.g. `systemd-unit`)

When no qualifier is given, resolution prefers a definition in the same document, otherwise the first one found.

To display the directives list (currently in `directives.rst`), simply use this custom Sphinx directive:

```rst
.. systemd:directiveindex::
```

To link to this directives page, use

```rst
:ref:`systemd.directives(7)`
.. or
:doc:`directives`
```

### Declaring and using includes

reStructuredText allows the inclusion of sections from other files, but `rst` elements generally don’t have ids and there is no way to address or traverse a document’s contents with something like `xpath`, as was previously the case in the Docbook XML docs. For this reason, we need to be explicit about which sections of a file are includable.

While it trivial to include an entire `rst` file inside another one, only including *parts* of other files is slightly more involved, since `rst` has no easily addressable elements. Mapping to the rst `.. include::` directive’s `start-after` and `end-before` options, we use corresponding marker comments to define includable sections in these source files. These markers are, for example:

```rst
.. inclusion-marker-do-not-remove {xpointer-id}|
.. inclusion-end-marker-do-not-remove {xpointer-id}|
```

Here is a directive enclosed by such inclusion markers (in XML, this used to be `<varlistentry id='no-pager'>`):

```rst
.. inclusion-marker-do-not-remove no-pager|

    .. systemd:option:: --no-pager

      Do not pipe output into a pager.

.. inclusion-end-marker-do-not-remove no-pager|
```

> [!CAUTION]
> Note the pipe `|` used to delimit the marker’s end. This is crucial, as markers with the same prefix are often nested (`option-name-text` nested inside `option-name`, for example), and omitting a delimiter causes problems, since the include can then run too short or too long because it matches with the wrong end marker. We STRONGLY encourage always delimiting include ids this way.

This is the syntax to include the above section section (in XML, this used to be `<xi:include href="standard-options.xml" xpointer="no-pager" />`):

```rst
.. include:: ./standard-options.rst
  :start-after: .. inclusion-marker-do-not-remove no-pager|
  :end-before: .. inclusion-end-marker-do-not-remove no-pager|
```

Since `rst` does not support all inclusion scenarios that occur within the systemd docs, we have added a second, more capable inclusion syntax that is handled in a Sphinx preprocessor extension (see the file `_ext/preprocessor.py`). The syntax is similar:

```
%% include="standard-specifiers.rst" id="a|" %%
```

This essentially does the same thing as the longer `.. include::` declaration above, but works inside tables and other block elements within which `rst` doesn’t allow includes. So `%% include` can also be used as a shorthand for `.. include::`. Note the `|` pipe delimiter inside the id here too.

### Using External man Links

There are a couple of external domains that are very frequently linked to. We provide shorthand roles for these so you don’t have to remember how to construct the URLs.

For example, link to a Mankier or FreeBSD page with:

```rst
:mankier:`tpm2_getcap(1)`

or

:freebsd:`inetd(8)`
```

The following shorthand domains are available:

```
- :man-pages: -> https://man7.org/linux/man-pages/man{manvolnum}/{refentrytitle}.{manvolnum}.html
- :die-net: -> http://linux.die.net/man/{manvolnum}/{refentrytitle}
- :mankier: -> https://www.mankier.com/{manvolnum}/{refentrytitle}
- :archlinux: -> https://man.archlinux.org/man/{refentrytitle}.{manvolnum}.en.html
- :debian: -> https://manpages.debian.org/unstable/{refentrytitle}/{refentrytitle}.{manvolnum}.en.html
- :freebsd: -> https://www.freebsd.org/cgi/man.cgi?query={refentrytitle}&sektion={manvolnum}
- :dbus: -> https://dbus.freedesktop.org/doc/dbus-specification.html#{refentrytitle}
- :openssl: -> https://docs.openssl.org/master/man{manvolnum}/{refentrytitle}
```

These are defined in the Sphinx extension "External Man Links", in `_ext/external_man_links.py`.

---

For more information, please consult the general documentation [README](/README.md).
